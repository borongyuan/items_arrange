<!DOCTYPE html>
<html>
<head>
<title>rawDetectAlgorithm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
/* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */
/* Author: Nicolas Hery - http://nicolashery.com */
/* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */
/* Source: https://github.com/nicolahery/markdownpad-github */

/* RESET
=============================================================================*/

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
}

/* BODY
=============================================================================*/

body {
  font-family: Helvetica, arial, freesans, clean, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
  padding: 20px;
  max-width: 960px;
  margin: 0 auto;
}

body>*:first-child {
  margin-top: 0 !important;
}

body>*:last-child {
  margin-bottom: 0 !important;
}

/* BLOCKS
=============================================================================*/

p, blockquote, ul, ol, dl, table, pre {
  margin: 15px 0;
}

/* HEADERS
=============================================================================*/

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
}

h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {
  font-size: inherit;
}

h1 {
  font-size: 28px;
  color: #000;
}

h2 {
  font-size: 24px;
  border-bottom: 1px solid #ccc;
  color: #000;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777;
  font-size: 14px;
}

body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {
  margin-top: 0;
  padding-top: 0;
}

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}

h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {
  margin-top: 10px;
}

/* LINKS
=============================================================================*/

a {
  color: #4183C4;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* LISTS
=============================================================================*/

ul, ol {
  padding-left: 30px;
}

ul li > :first-child, 
ol li > :first-child, 
ul li ul:first-of-type, 
ol li ol:first-of-type, 
ul li ol:first-of-type, 
ol li ul:first-of-type {
  margin-top: 0px;
}

ul ul, ul ol, ol ol, ol ul {
  margin-bottom: 0;
}

dl {
  padding: 0;
}

dl dt {
  font-size: 14px;
  font-weight: bold;
  font-style: italic;
  padding: 0;
  margin: 15px 0 5px;
}

dl dt:first-child {
  padding: 0;
}

dl dt>:first-child {
  margin-top: 0px;
}

dl dt>:last-child {
  margin-bottom: 0px;
}

dl dd {
  margin: 0 0 15px;
  padding: 0 15px;
}

dl dd>:first-child {
  margin-top: 0px;
}

dl dd>:last-child {
  margin-bottom: 0px;
}

/* CODE
=============================================================================*/

pre, code, tt {
  font-size: 12px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
}

code, tt {
  margin: 0 0px;
  padding: 0px 0px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre>code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #ccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

pre code, pre tt {
  background-color: transparent;
  border: none;
}

kbd {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    background-color: #DDDDDD;
    background-image: linear-gradient(#F1F1F1, #DDDDDD);
    background-repeat: repeat-x;
    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
    border-image: none;
    border-radius: 2px 2px 2px 2px;
    border-style: solid;
    border-width: 1px;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

/* QUOTES
=============================================================================*/

blockquote {
  border-left: 4px solid #DDD;
  padding: 0 15px;
  color: #777;
}

blockquote>:first-child {
  margin-top: 0px;
}

blockquote>:last-child {
  margin-bottom: 0px;
}

/* HORIZONTAL RULES
=============================================================================*/

hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  border-bottom: 4px solid #ddd;
  padding: 0;
}

/* TABLES
=============================================================================*/

table th {
  font-weight: bold;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 6px 13px;
}

table tr {
  border-top: 1px solid #ccc;
  background-color: #fff;
}

table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

/* IMAGES
=============================================================================*/

img {
  max-width: 100%
}
</style>
</head>
<body>
<h1>融合体位体动的脑电算法说明文档</h1>
<h3>算法构建流程</h3>
<ul>
<li>收集数据：脑电数据、体位体动结果</li>
<li>处理数据：对脑电数据先进行滑动平均滤波处理</li>
<li>分析数据：通过分析脑电数据以及体位体动结果，最终我们选择脑电数据特征有两个：alpha波能量均值与belta波能量均值的比值、alpha波能量均值与delta波能量均值的比值，其中用alpha波能量均值与belta波能量均值的比值来区分是否睡着（包括清醒期WAKE、REM期、SLEEP期），用alpha波能量均值与delta波能量均值的比值来区分睡觉的深浅度（DEEP<em>SLEEP、LIGHT</em>SLEEP)；结合体位体动结果，如果在一个30s内出现直立或者倒立体位，则认为处于清醒期，如果在睡着的情况下有比较大的体动，则认为处于浅睡期。</li>
<li>算法建立：通过收集多组不同脑电数据，计算并调整各个特征的门限值，建立了融合体位体动的脑电算法</li>
<li>算法验证：已通过了验证，效果目前还在测试优化中</li>
</ul>
<h3>算法用到的各个参数</h3>
<ul>
<li>MAXHOUR：最大睡觉小时数，默认值：20</li>
<li>SECONDS<em>OF</em>EPOCH：脑电输出结果的采样频率，默认值：30</li>
<li>EPOCH<em>OF</em>HOUR：1小时内输出脑电结果的数目，默认值：120</li>
<li>NFFT：傅里叶变换的长度，默认值：256</li>
<li>NaN： 无效信号返回值，默认值：-1</li>
<li>ORIGINAL_THRESHOLD：alpha波能量均值与belta波能量均值的比值的门限值，默认值：3</li>
<li>ORIGINAL_THRESHOLD2：alpha波能量均值与delta波能量均值的比值的门限值，默认值：3</li>
<li>WAKE：表示清醒期，默认值：4</li>
<li>LIGHT：表示浅睡期，默认值：3</li>
<li>DEEP：表示深睡期，默认值：2</li>
<li>REM：表示眼球运动期，默认值：5</li>
<li>MAXENPOCH：脑电结果输出数目的最大值，默认值：MAXHOUR*EPOCH<em>OF</em>HOUR</li>
<li>MAXSECOND：睡觉总秒数的最大值，默认值：SECONDS<em>OF</em>EPOCH<em>EPOCH<em>OF</em>HOUR</em>MAXHOUR</li>
</ul>
<h3>算法调用说明</h3>
<p>非实时算法调用命令：</p>
<pre><code>void  eeg_detect_algorithm(int* rawdata, float *fftdata, int *bodyposition, int *bodymove, int style_totalSecond, int raw_totalSecond, int *score); 
@输入参数
        rawdata: 数组，例如总长度为（256*3600秒*10小时），原始时域信号，采样率256Hz
        fftdata: 数组，长度与rawdata相同，例如总长度为（256*3600秒*10小时），原始时域信号每秒256点FFT后结果的绝对值平方
        bodyposition: 一维向量，计算出的整夜的体位值，每个数据点时间间隔为半秒 
        bodymove: 一维向量， 算出的整夜的体动值，每个数据点时间间隔为半秒
        rawdata_len: 数组元素个数 
        style_totalSecond：总时间量，单位：半秒. 
        raw_totalSecond: 总时间量，单位：秒.
@输出参数
        score：字符数组，例如总长度为1200. 整个数组标书整夜分期结果，数组内的每个元素对应每30秒的分期结果。

@return
        无
</code></pre>

<p>实时算法调用命令：</p>
<pre><code>void rtEpoch(int* rawdata, float *fftdata, int notFirst, float *epoch, float *epoch2, int *epochValid);
@输入参数
        rawdata: 数组，例如总长度为（256*3600秒*20小时），原始时域信号，采样率256Hz
        fftdata: 数组，长度与rawdata相同，例如总长度为（256*3600秒*20小时），原始时域信号每秒256点FFT后结果的绝对值平方
        notFirst: 整数，初始值为0，之后每隔30s值加1 

@输出参数
        epoch：数组，例如总长度为2400，区分是否睡觉的门限值变化曲线 
        epoch2：数组，总长度与epoch相同，例如总长度为2400，区分深睡和浅睡的门限值变化曲线
        epochValid：数组，总长度与epoch相同，判断每30s是否有效，1为有效，-1则为无效 
@return
        无


void nrtAASM(float *epoch, float *epoch2, int totalEpoch, int *epochValid, int *score);
@输入参数
        epoch：数组，例如总长度为2400，区分是否睡觉的门限值变化曲线 
        epoch2：数组，总长度与epoch相同，例如总长度为2400，区分深睡和浅睡的门限值变化曲线
        totalEpoch: 整数， 表示总共有多少个30s
        epochValid：数组，总长度与epoch相同，判断每30s是否有效，1为有效，-1则为无效

@输出参数
        score：数组，总长度与epoch长度相同，脑电分期结果 

@return
        无


void eeg_detect_algorithm(int *bodyposition, int *bodymove, int style_totalSecond, int raw_totalSecond, int *score);

@输入参数
        bodyposition：数组，记录的整夜体位变化值 
        bodymove：数组，记录的整夜体动变化值 
        style_totalSecond: 整数， bodyposition对应的元素个数 
        raw_totalSecond：数组，总共记录脑电的秒数 

@输出参数
        score：数组，总长度与epoch长度相同，脑电与体位融合后的脑电分期结果 

@return
        无
</code></pre>

<h3>数值输出含义与范围</h3>
<p>脑电分期值：可以取值-1，2，3，4，5，其中-1表示无效信号值，2表示深睡，3表示浅睡，4表示清醒，5表示REM</p>

</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
